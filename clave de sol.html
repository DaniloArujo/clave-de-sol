<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Estudos de Leitura de Partitura - Clave de Sol</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* --- Vari√°veis Globais de Estilo --- */
        :root {
            --primary-color: #6d28d9;
            --success-color: #22c55e;
            --error-color: #ef4444;
            --info-color: #3b82f6;
            --light-gray: #f3f4f6;
            --gray: #6b7280;
            --dark-gray: #374151;
        }

        /* --- Reset e Estilos Base --- */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        /* --- Componentes da UI --- */
        .container {
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(15px);
            border-radius: 24px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 40px;
            max-width: 900px;
            width: 100%;
            margin-bottom: 20px;
        }

        h1 {
            text-align: center;
            color: var(--dark-gray);
            margin-bottom: 30px;
            font-size: 2.5em;
            font-weight: 300;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        label {
            font-weight: 600;
            color: var(--gray);
            font-size: 0.9em;
        }

        select, .action-button {
            padding: 12px 24px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s ease;
            background-color: rgba(255, 255, 255, 0.7);
            color: var(--dark-gray);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
        }

        select:focus, .action-button:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.4);
        }

        .action-button {
            background: var(--primary-color);
            color: white;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .action-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(109, 40, 217, 0.3);
        }

        .action-button:active {
            transform: translateY(0);
            box-shadow: 0 5px 10px rgba(109, 40, 217, 0.2);
        }

        /* --- Se√ß√£o da Pauta Musical --- */
        .staff-container {
            background: white;
            border-radius: 16px;
            padding: 40px;
            margin: 30px 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 250px;
            border: 1px solid var(--light-gray);
            box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .staff {
            position: relative;
            width: 100%;
            max-width: 600px;
            height: 200px; /* Altura fixa para refer√™ncia de posicionamento das notas */
        }
        
        .staff-line {
            position: absolute;
            width: 100%;
            height: 2px;
            background: #ccc;
            left: 0;
        }
        
        /* Posi√ß√µes das 5 linhas da pauta */
        .staff-line:nth-child(1) { top: 140px; }
        .staff-line:nth-child(2) { top: 110px; }
        .staff-line:nth-child(3) { top: 80px; }
        .staff-line:nth-child(4) { top: 50px; }
        .staff-line:nth-child(5) { top: 20px; }

        .clef {
            position: absolute;
            font-size: 100px;
            color: var(--dark-gray);
            line-height: 1;
            user-select: none;
            z-index: 1;
            top: 38px;
            left: 10px;
        }

        .note {
            position: absolute;
            width: 24px;
            height: 16px;
            background: var(--dark-gray);
            border-radius: 50%;
            left: 50%;
            transform: translateX(-50%) translateY(-50%);
            transition: all 0.3s ease;
            z-index: 3; 
        }

        .note.correct { background: var(--success-color); }
        .note.incorrect { background: var(--error-color); }

        .ledger-line {
            position: absolute;
            width: 40px;
            height: 2px;
            background: #999;
            left: calc(50% - 20px);
            z-index: 2; 
        }

        /* --- Se√ß√£o de Respostas e Feedback --- */
        .answer-section {
            text-align: center;
            margin: 30px 0;
        }

        .note-buttons {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            max-width: 600px;
            margin: 0 auto;
        }

        .note-button {
            padding: 15px 25px;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 600;
            font-size: 18px;
            color: var(--dark-gray);
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }

        .note-button:hover {
            background: var(--light-gray);
            border-color: #d1d5db;
            transform: translateY(-2px);
        }

        .note-button:active {
            transform: translateY(0);
            background-color: #e5e7eb;
        }

        .feedback {
            text-align: center;
            margin: 20px 0;
            font-size: 1.2em;
            font-weight: 600;
            min-height: 30px;
            transition: color 0.3s ease;
        }

        .feedback.correct { color: var(--success-color); }
        .feedback.incorrect { color: var(--error-color); }
        
        /* --- Se√ß√£o de Pontua√ß√£o --- */
        .score {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 40px;
            font-size: 1.1em;
            font-weight: 600;
            flex-wrap: wrap;
        }

        .score-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 20px;
        }
        
        .score-item div:first-child { font-weight: 400; color: var(--gray); }
        .score-item div:last-child { font-size: 1.5em; }

        .correct-score div:last-child { color: var(--success-color); }
        .incorrect-score div:last-child { color: var(--error-color); }
        .total-score div:last-child { color: var(--info-color); }

    </style>
</head>
<body>
    <div class="container">
        <h1>üéµClave de Sol</h1>
        
        <div class="controls">
            <div class="control-group">
                <label for="difficulty-select">Dificuldade</label>
                <select id="difficulty-select">
                    <option value="basic">B√°sico</option>
                    <option value="intermediate">Intermedi√°rio</option>
                </select>
            </div>
            
            <button id="new-note-btn" class="action-button">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 18V5l12-2v13"/><path d="M9 18a3 3 0 1 1-6 0 3 3 0 0 1 6 0z"/><path d="M21 16a3 3 0 1 1-6 0 3 3 0 0 1 6 0z"/></svg>
                Nova Nota
            </button>
        </div>

        <div class="staff-container">
            <div class="staff" id="staff">
                <div class="staff-line"></div>
                <div class="staff-line"></div>
                <div class="staff-line"></div>
                <div class="staff-line"></div>
                <div class="staff-line"></div>
                <div class="clef" id="clef">ùÑû</div>
                <div class="note" id="note" style="display: none;"></div>
            </div>
        </div>

        <div class="feedback" id="feedback"></div>

        <div class="answer-section">
            <div class="note-buttons" id="note-buttons">
                <button class="note-button" data-note="C">D√≥</button>
                <button class="note-button" data-note="D">R√©</button>
                <button class="note-button" data-note="E">Mi</button>
                <button class="note-button" data-note="F">F√°</button>
                <button class="note-button" data-note="G">Sol</button>
                <button class="note-button" data-note="A">L√°</button>
                <button class="note-button" data-note="B">Si</button>
            </div>
        </div>

        <div class="score">
            <div class="score-item correct-score">
                <div>Acertos</div>
                <div id="correct-count">0</div>
            </div>
            <div class="score-item incorrect-score">
                <div>Erros</div>
                <div id="incorrect-count">0</div>
            </div>
            <div class="score-item total-score">
                <div>Total</div>
                <div id="total-count">0</div>
            </div>
        </div>
    </div>

    <script>
        // --- DADOS EST√ÅTICOS E DE CONFIGURA√á√ÉO ---
        // Mapeamento de notas para posi√ß√µes na pauta (top em pixels) e linhas suplementares.
        const NOTE_POSITIONS = {
            basic: {
                'E4':{ top: 140, note:'E' }, 'F4':{ top: 125, note:'F' }, 'G4':{ top: 110, note:'G' },
                'A4':{ top: 95,  note:'A' }, 'B4':{ top: 80,  note:'B' }, 'C5':{ top: 65,  note:'C' },
                'D5':{ top: 50,  note:'D' }, 'E5':{ top: 35,  note:'E' }, 'F5':{ top: 20,  note:'F' },
            },
            intermediate: {
                'C4':{ top: 170, note:'C', ledgerLines:[170] }, 'B3':{ top: 185, note:'B', ledgerLines:[170] },
                'A3':{ top: 200, note:'A', ledgerLines:[170, 200] },
                'G5':{ top: 5,   note:'G', ledgerLines:[] }, 'A5':{ top: -10, note:'A', ledgerLines:[-10] },
                'B5':{ top: -25, note:'B', ledgerLines:[-10] }, 'C6':{ top: -40, note:'C', ledgerLines:[-10, -40] },
            }
        };

        // Mapeamento dos nomes das notas para portugu√™s.
        const NOTE_NAMES_PT = {'C':'D√≥', 'D':'R√©', 'E':'Mi', 'F':'F√°', 'G':'Sol', 'A':'L√°', 'B':'Si'};
        
        // --- CLASSE PRINCIPAL DA APLICA√á√ÉO ---
        class MusicStaffTrainer {
            constructor() {
                // Estado da aplica√ß√£o
                this.currentNote = null;
                this.correctCount = 0;
                this.incorrectCount = 0;
                this.isAnswered = false; // Impede m√∫ltiplas respostas para a mesma nota

                // Refer√™ncias aos elementos do DOM
                this.elements = {};

                this.cacheDOMElements();
                this.initializeEventListeners();
                this.startNewRound();
            }

            /** Armazena as refer√™ncias aos elementos do DOM para acesso r√°pido. */
            cacheDOMElements() {
                this.elements.difficultySelect = document.getElementById('difficulty-select');
                this.elements.newNoteBtn = document.getElementById('new-note-btn');
                this.elements.staff = document.getElementById('staff');
                this.elements.note = document.getElementById('note');
                this.elements.feedback = document.getElementById('feedback');
                this.elements.noteButtons = document.getElementById('note-buttons');
                this.elements.correctCount = document.getElementById('correct-count');
                this.elements.incorrectCount = document.getElementById('incorrect-count');
                this.elements.totalCount = document.getElementById('total-count');
            }

            /** Configura todos os listeners de eventos. */
            initializeEventListeners() {
                this.elements.difficultySelect.addEventListener('change', () => this.startNewRound());
                this.elements.newNoteBtn.addEventListener('click', () => this.startNewRound());
                
                // Delega√ß√£o de evento para os bot√µes de nota
                this.elements.noteButtons.addEventListener('click', (e) => {
                    if (e.target.classList.contains('note-button')) {
                        this.checkAnswer(e.target.dataset.note);
                    }
                });

                // Atalhos de teclado
                document.addEventListener('keydown', (e) => {
                    const keyMap = {'c':'C','d':'D','e':'E','f':'F','g':'G','a':'A','b':'B'};
                    if (keyMap[e.key.toLowerCase()]) {
                        this.checkAnswer(keyMap[e.key.toLowerCase()]);
                    } else if (e.key === ' ' || e.key === 'Enter') {
                        e.preventDefault();
                        this.startNewRound();
                    }
                });
            }

            /** Inicia uma nova rodada, gerando uma nova nota. */
            startNewRound() {
                this.isAnswered = false;
                this.clearFeedback();
                this.generateNewNote();
            }

            /** Gera e exibe uma nova nota na pauta. */
            generateNewNote() {
                const difficulty = this.elements.difficultySelect.value;
                
                // Combina as notas b√°sicas com as intermedi√°rias se necess√°rio
                const availablePositions = { ...NOTE_POSITIONS.basic };
                if (difficulty === 'intermediate') {
                    Object.assign(availablePositions, NOTE_POSITIONS.intermediate);
                }
                
                const positionKeys = Object.keys(availablePositions);
                const randomKey = positionKeys[Math.floor(Math.random() * positionKeys.length)];
                const positionData = availablePositions[randomKey];
                
                this.currentNote = positionData.note;
                this.drawNote(positionData);
            }

            /** Desenha a nota e suas linhas suplementares na pauta. */
            drawNote(position) {
                // Limpa linhas suplementares antigas
                const existingLedgers = this.elements.staff.querySelectorAll('.ledger-line');
                existingLedgers.forEach(ledger => ledger.remove());

                // Posiciona a nota
                this.elements.note.style.top = position.top + 'px';
                this.elements.note.style.display = 'block';

                // Adiciona novas linhas suplementares se houver
                if (position.ledgerLines) {
                    position.ledgerLines.forEach(lineTop => {
                        const ledgerLine = document.createElement('div');
                        ledgerLine.className = 'ledger-line';
                        ledgerLine.style.top = lineTop + 'px';
                        this.elements.staff.appendChild(ledgerLine);
                    });
                }
            }
            
            /** Verifica a resposta do usu√°rio. */
            checkAnswer(selectedNote) {
                if (this.isAnswered) return; // Se j√° respondeu, ignora
                this.isAnswered = true;
                
                if (selectedNote === this.currentNote) {
                    this.handleCorrectAnswer();
                } else {
                    this.handleIncorrectAnswer();
                }
                this.updateScoreDisplay();
            }

            /** A√ß√µes a serem tomadas quando a resposta est√° correta. */
            handleCorrectAnswer() {
                this.correctCount++;
                this.displayFeedback('‚úì Correto!', 'correct');
                this.elements.note.className = 'note correct';
                setTimeout(() => this.startNewRound(), 1200);
            }

            /** A√ß√µes a serem tomadas quando a resposta est√° incorreta. */
            handleIncorrectAnswer() {
                this.incorrectCount++;
                const correctNoteName = NOTE_NAMES_PT[this.currentNote] || this.currentNote;
                this.displayFeedback(`Incorreto! A nota era ${correctNoteName}`, 'incorrect');
                this.elements.note.className = 'note incorrect';
            }

            /** Atualiza o placar na interface. */
            updateScoreDisplay() {
                this.elements.correctCount.textContent = this.correctCount;
                this.elements.incorrectCount.textContent = this.incorrectCount;
                this.elements.totalCount.textContent = this.correctCount + this.incorrectCount;
            }

            /** Exibe uma mensagem de feedback para o usu√°rio. */
            displayFeedback(message, statusClass) {
                this.elements.feedback.textContent = message;
                this.elements.feedback.className = `feedback ${statusClass}`;
            }

            /** Limpa a mensagem e o estilo do feedback e da nota. */
            clearFeedback() {
                this.elements.feedback.textContent = '';
                this.elements.feedback.className = 'feedback';
                this.elements.note.className = 'note';
            }
        }

        // Inicia a aplica√ß√£o quando o DOM estiver completamente carregado.
        document.addEventListener('DOMContentLoaded', () => new MusicStaffTrainer());
    </script>
</body>
</html>